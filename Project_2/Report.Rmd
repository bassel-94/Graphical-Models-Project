---
title: "Studying the effect of lethality on protein-protein interactions in Yeast"
author: "Michael DARMOUTOMO, Guillaume FRANCHI and Bassel MASRI"
date: "1/1/2021"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction and research quesion

Protein–protein interactions (PPI) are key to protein functions and regulations within the cell cycle, DNA replication, and cellular signaling. Therefore, detecting whether a pair of proteins interact is of great importance for the study of molecular biology. Indeed, the ultimate goal when predicting PPI interactions is to predict the formation of links between them. Furthermore, modeling PPI's have become a key step in the realization of protein function within cell cycle progression, DNA replication, and signal transmission. For our graphical models project, we have chosen to identify the architecture of a yeast PPI network in order to determine if the proteins' interactions are best described by a statistical law or if it is random. Secondly, the data also describes a certain of level of lethality linked to the removal of a protein which can be correlated with the number of iteractions the protein has. Quantifying the effect of lethality on forming links would proove or disproove this correlation which was also the goal of our project through network modeling techniques.

## Methodoly

### Analysis steps

Investigating protein–protein interactions network relate to examine the correlation between forming links and classifying the lethality of a protein. While typial machine learning algorithms such as random forests, neural networks, ensemble classifiers, and Naive Bayes classifiers are often proposed for classification problems and, therefore, detecting lethality of protein when analyzing PPIs datasets, network modeling techniques can offer a significant insight on the interaction between said proteins. Therefore, the steps for analyzing the PPI network start with a typical exploratory data analysis to capture as much information as we can about the network. We then implement numerical sumilations to capture the structure of the network in the aim of quantifying its properties (e.g. random and small world properties) and finally, we fit different models on the network to predict the formation of links based on the network's attributes which would help answer our main research question -is there a statistically significant correlation between the formation of links between proteins and lethality?

### Protein-Protein-Interaction yeast network

For our project, we have chosen the protein network which can be found in the package *networkdata* in R. The protein network was built by Jeong, Mason, Barabasi and Oltvai (2001) who examined a data matrix that contained interactions linking 2114 proteins contained in yeast. Earlier experimental work had demonstrated that some of the protein molecules in yeast were lethal; if they were removed the yeast would die. Removing others, however, had no such dramatic effect. So Jeong et al. examined the question of whether the structural properties of those proteins, in particular their degree centralities, could predict which proteins were lethal and which ones were not.

### Preprocessing step

Upon general descriptive analysis of the network information, we notice that the main attribute we are interested in, lethality, contains the following classes; lethal, Non-lethal, Unknown and some other protein interactions that are unclassified. Therefore, the first step in our analysis was to perform some data preprocessing to make the attributes clearer. The unclassified proteins are put in a class called other which will not be examined in the analysis. The final list of attributes on which we conduct the analysis is the following : 

* Lethal
* Non-lethal
* Unknown
* Other

After running some summary statistics in *R*, we get a graph density of about $0.001$.

## Exploratory Data Analysis

### Visual exploration of the network

As with all statistical modeling, data exploration is advised prior to network model development. In the case of network data, visualization and descriptive statistics can give some insight into the structure of a network that can be helpful during the development and evaluation of a statistical model. The first thing we will do is a visualization of the network with node color showing the lethality attribute which can aid in identifying patterns of ties among proteins with different characteristics.

```{r, include = FALSE, echo = FALSE}
rm(list=ls())
library(network)
library(igraph)
library(intergraph)
library(networkdata)
library(sna)
library(ggplot2)
library(RColorBrewer)
```

```{r, echo = FALSE}
#-- load data and compute summary statistics
data(protein)
protein = simplify(protein, remove.multiple = TRUE)

# Select vertices with different lethality name
others = which(!(igraph::vertex_attr(protein, "lethality") %in% c("Unknown", "Lethal", "Non-Lethal")))

# Set selected vertice attributes to "Other"
protein = set_vertex_attr(protein, "lethality", others, "Other")

# Save a network object of protein dataset as well
protein_net = asNetwork(protein)
```

```{r net-one, echo = FALSE, fig.align='center', fig.width=6, fig.height=6,  fig.cap= "Network visualization"}
#-- set color palette
my.pal = brewer.pal(length(unique(protein_net%v%"lethality")),"Set1")
l = my.pal[as.factor(protein_net%v%"lethality")]

#-- plotting network with colors according to lethality
set.seed(123)
plot(protein_net, vertex.col = l, edge.col = "grey40", main = "Interaction among the proteins", vertex.cex =0.7, cex.main = 0.8)
legend("bottomright", legend=c("Lethal", "Non-Lethal", "Other", "Unknown"), col = my.pal, pch = 19, pt.cex=0.9, cex = 0.5)
```

Table \ref{tab:tab-one} shows the frequency distribution of the different levels of lethality in the network.

```{r tab-one, echo = FALSE}
knitr::kable(
  table(as.factor(protein_net%v%"lethality")), 
  caption = 'Frequency table of the attribute lethality', 
  col.names = c("Level", "Count")
)
```

Preliminary visual analysis of the network graphic through \ref{fig:net-one} and \ref{tab:tab-one} show that most proteins in the network fall under the category of non-lethal and many of them are *not* clustered towards the center (i.e. on the outskirts of the network with no edges) with no apparent edges (or links). More clustering formations are noticable towards the center of the graph but we cannot easily distinguish the groups that are clustered together. We can also note that some lethal proteins, code colored red, have significant interactions with other proteins.

Having a large number of nodes in the network can sometimes obscure important patterns in a network graph. Displaying the largest component (i.e. largest connected group of nodes) in a network can aid in clarifying patterns visually. The largest component which contains most of the nodes in the network can be isolated and graphed. 

Vertex size is anoother ways to visually discern patterns in our network structure. Therefore, the last visual exploratory analysis that we will perform is a plot where the network is colored according to lethality of the proteins and their corresponding vertices would be sized according to a specific measure like the degree. Degree is the number of links a network member has. In this case, degree would represent the number of ties for each pair of proteins in the protein network. 

In order to avoid a plot where we obtain a very large node sizes that overlap and obscure the ties, the size of the nodes can be reduced by reducing the values of degree in the attribute by a facor of 10.

Figure \ref{fig:net-two} below helps distinguish some more apparent clusterings among the proteins by plotting only the main components and sizing the vertices by their degrees. Indeed, we can clearly discern the biggest nodes that correspond to the non-lethal and lethal proteins indicating higher degrees and, by interpretation, higher probability of forming a tie with other proteins. In other words, lethal and non-lethal proteins have high degrees. To what class of proteins have a tendency to form ties with remains, at this stage, unexplored. Later data exploration techniques will help bring these patterns to light.

It is also woth mentioning that clusters of protein classified 'unknown' and 'other' are less significant.

```{r net-two, fig.align='center', fig.width=6, fig.height=6, fig.cap="Network showing main components and size according to their degrees", echo = FALSE, warning=FALSE}
prot_comp = component.largest(protein_net)
prot_small = protein_net[prot_comp,prot_comp]
smallnet = as.network(prot_small, directed=FALSE, remove.loops = FALSE )

lethality = network::get.vertex.attribute( protein_net, 'lethality')
sub_lethality = as.vector(subset(lethality, prot_comp!="FALSE"))

smallnet %v% "lethality" = sub_lethality

l = my.pal[as.factor(smallnet%v%"lethality")]
plot( smallnet, vertex.col = l, edge.col = "grey40", main = "Interaction among the proteins with different sizes", vertex.cex = degree(smallnet, gmode='graph')/10, cex.main = 0.8)
legend("bottomright", legend=c("Lethal", "Non-Lethal", "Other", "Unknown"), col = my.pal, pch = 19, pt.cex=0.9, cex = 0.5)
```

### Descriptive analysis of the network

#### Degree distribution

In addition to visualization, examining network and node characteristics can provide some insight into network structures and possible modeling strategies. Network size and density have been discussed earlier in the introduction. In this section, we will focus on the average number of links per node (mean degree), through a histogram describing the distribution along with a summary statistics table for a better quantitative description.

```{r hist, fig.align='center', fig.width=5, fig.height=3.5, fig.cap="Degree distribution of the proteins", echo = FALSE, warning=FALSE }
protein.degrees.df = data.frame(degree = igraph::degree(protein))
ggplot(protein.degrees.df) + 
  ggtitle("Degree distribution of protein dataset") + 
  aes(degree) + geom_histogram(binwidth = 2) + theme_bw() + theme(plot.title = element_text(size = 10, face = "bold", hjust = 0.5))
```

```{r stat, echo = FALSE}
df = data.frame(unclass(summary(igraph::degree(protein))))
knitr::kable(round(df,1), caption = 'Summary statistics of the degree distribution of PPI network', col.names = c("Value"))
```

Indeed, like any real world dataset, we see through figure \ref{fig:hist} and tabel \ref{tab:stat} that most nodes do not interact woth other nodes indicating that proteins mostly do not interact with each other. The degree distribution histogram also shows that some proteins have a high degree indicating the bigger nodes seen in graph \ref{fig:net-two} in the PPI network.

The average mean degree is roughly $2.1$ indicating that proteins are connected to, and therefore linked with, an average of about $2$ other proteins.

#### Mixing matrix

The network visualizations above showed some potential clustering; another option for identifying clustering is to examine mixing matrices and correlation coefficients. Mixing matrices can be used to examine the number of connected dyads (pairs of proteins in our case) for each possible combination of levels for a categorical node attribute. 

For example, how many connected dyads are forming when both proteins are classified as non-lethal or is there some clustering between lethal proteins and non-lethal ones? We already found some evidence of clustering by different levels of lethality and a mixing matrix can help confirm these patterns.




```{r mixmat, echo = FALSE}
knitr::kable(mixingmatrix(protein_net, "lethality")[[2]], caption = "Mixing matrix of the attribute lethality")
```

Indeed, the mixing matrix shown in table \ref{tab:mixmat} indicates a bias towards forming ties between proteins when they hold different classes (i.e. non-lethal with lethal). This may be captured later on we take into account homophily in the network in the following section. 

More in detail, of the 886 connected dyads including lethal proteins, about 25% (218 proteins) are linked with ones that are also classified as lethal. However, a much higher number of links are formed with non-lethal proteins. 

One way to further explore the likelihood of forming a tie based on the class of proteins is through a visual representation of the average number of links for each class. The latter can help further examine the relationship between lethality and network structure.

```{r rel, fig.align='center', fig.width=5, fig.height=4, fig.cap="Average link per protein category", echo=FALSE}
#-- means to plot
n = degree(protein_net, gmode='graph')
m = tapply(n, lethality, mean)

#-- plot the average links per lethality
plot(sort(m), type = "b", cex = 0.7,
     col = "blue4",
     axes = FALSE, 
     ylab="Average links", 
     xlab="Lethality level",
     main ="Relationship between lethality and links",
     cex.main = 0.7,
     cex.lab = 0.5)
axis(1, at=1:4, lab=c("Unknown", "Non-lethal", "Other", "Lethal"), cex.axis = 0.5)
axis(2, cex.axis = 0.5)
box()
```

```{r freqt, echo = FALSE}
knitr::kable(round(sort(m),1), col.names = "Average link", caption = "Average links per class of protein")
```

Figure \ref{fig:rel} and table \ref{tab:freqt} confirm that lethal proteins have a higher number of links thus indicating that proteins of high degree are indeed more likely to be lethal than those of lower degree.

### Small World simulation

As with many forms of model building, statistical network modeling should begin with a null model. The null model is a simple random graph model, there are no complex dependence assumptions to account for.

Although the null model is a good representation of the observed density of the PPI network, it is unlikely to be a good representation of other observed network characteristics. Simulating the network's measures based on the small world property can aid in understanding how well the latter captures the structures comprising the observed network.

## Modeling and predicting probabilities

### Exponential random graph modeling

In the aim of building a model that captures the hidden structure the network as well as answering the question whether node attributes influence the likelihood of a link, we will fit an exponential random graph model. Descriptive statistics throughout the study indicated that the class of proteins may influence the number of interactions among them. To examine the influence of these node attributes on the likelihood of a tie, we will build three different models : 

* ERGM where we consider the lethality as the main effect (i.e. using nodefactor)
* ERGM where we consider the interaction terms for the nodal attribute lethality (i.e. nodematch)
* ERGM where both interation terms as well as main effects are considered.

As means of model comparison and model goodness of fit study, we will look at the Bayesian Information Criterion and the diagnostic plots produced by the function *gof* of the *ergm* package in *R*.

Hypotheses testing the main effects and the interaction terms can be worded as follows :

 *$H_0$ = The category lethal does not affect the probability of forming ties between proteins
 *$H_1$ = The category lehal affects the probability of forming ties between proteins

By definition, nodefactor adds multiple statistics to the model, each one equal to the number of times a node with the specified attribute is at one end of an edge. To interpret the results in summary statistics of the model, it is necessary to know the reference group for any categorical variables. In the statnet package, the reference group in an ERGM defaults to the first group in the list shown in the summary of the network. In our case, the class "lethal" is the reference group for the attribute "lethality" by default. Since the "non-lethal" group contains the most nodes and, by extension, the highest degree, we have set it as the reference group.

The summary statistics of the first exponential random graph model produces the following output:

```{r, echo = FALSE, warning=FALSE, include=FALSE}
library(ergm)
ergm.fit.1 = ergm(protein_net ~ nodefactor("lethality", base = 2) + edges)
```

```{r, warning = FALSE, echo = FALSE}
print(summary(ergm.fit.1))
```

The estimates 'lethal' is significant and positive which indicates an increased likelihood to form ties for proteins when they have been classed as 'lethal' compared to those classified as 'unknown' and 'other'. These results are consistent with the mixing matrix in table \ref{tab:mixmat} and figure \ref{fig:rel}.

We can then proceed by computing the probability of forming a link between proteins based on the assumption that the main effect is "lethality" using the *plogis()* function. The result is 54.7% which is significantly high based on the fact that the density of network is just below $0.001$.

```{r, echo = FALSE, include = FALSE}
plogis(ergm.fit.1$coef[1])
```

In order to unveil the homophily in the network, we will fit the second model considering interaction terms. The summary statistics of the model is the following :

```{r, warnings = FALSE, echo = FALSE, include=FALSE}
ergm.fit.2 = ergm(protein_net ~ edges + nodematch("lethality", diff=T))
```

```{r, echo = FALSE}
summary(ergm.fit.2)
```

The first thing to notice is that the estimate that corresponds to nodematch.lethality.Other is -Inf. Looking again at the mixing matrix in table \ref{tab:mixmat}, we conclude that this is due to the absence of interactions of this class with other classes. Therefore, we will continue focusing on the two main classes of the network "Lethal" and "Non-lethal".

The resulting model shows significant positive coefficient for lethal homophily in the network. That is, two proteins in the same category "lethal" are more likely to be connected further confirming our findings. The model also shows non significant coefficients for the class non-lethal. In this case, predicting the probability of forming a tie goes up to 74.3% which means that the homophily is better captured in this model compared to the one where we only consider lethality as the main effect.

However, both models contained estimates in which the p-value is small enough to reject the null hypothesis.

```{r, echo = FALSE, include = FALSE}
plogis(ergm.fit.2$coef[2])
```

The last model that we will test is one where we include both nodematch and nodefactors for the attribute lethality which gives the following summary : 

```{r, echo = FALSE, warning = FALSE, include = FALSE}
ergm.fit.3 = ergm(protein_net ~ edges + nodematch("lethality", diff=T) + nodefactor("lethality", base = 2))
```

```{r, echo = FALSE}
print(summary(ergm.fit.3))
```

We notice an overall worse fit when we include the above features in our model. Estimates seem to be slightly less significant than the first two models where only main effect and similarity effect are considered independently. In the next subsection, we will further explore the goodness of fit diagnostics.

### Goodness of fit test

Finally, we will summarize all three BIC scores for all three models for comparison in the following table:

```{r comp, echo = FALSE}
dfs = data.frame(With_nodefactor = summary(ergm.fit.1)$bic, With_notematch = summary(ergm.fit.2)$bic, Both = summary(ergm.fit.3)$bic)
knitr::kable(round(dfs), caption = "BIC score for all three models", col.names = c("With main effect", "With nodematch", "nodematch & main effect"))
```

We can conclude that the model where lethality is considered the main effect yeilds the lowest BIC score indicating a better fit than the other two models seen above. To further explore the goodness of fit of the statistical model, we will compute the plots produced using the *gof* function.

```{r diag, echo = FALSE, fig.align='center', fig.width=6, fig.height=5, fig.cap="Diagnostic plots of the goodness of fit", warnings = FALSE}
par(mfrow = c(2,2))
gof.model = gof(ergm.fit.1)
plot(gof.model, main = "Goodness of fit diagnostics", cex.main= 0.4, cex.lab=0.5, cex.axis=0.5)
```

Visual analysis of the above goodness of fit plots indicate that the model is able to reconstruct the proportion of edges with respect to the edgewise shared partner
terms. This is an indication that our model was able to capture the underlying transitivity in the PPI network. The overall statistics of the levels of the attribute "lethality" are also well represented with a sligh underestimation for the nodefactor "unknown". 

However, the model overestimates the proportion of nodes that have lower degrees. For exemple, we notice a significant peak in the estimated line (code colored black) compared to the empirical estimations (code colored blue). This may be an indication that the degree distribution is not well represented by the model we built. One way to improve the fit of the model is to account for the degree distribution using the gwdegree term which stands for geometrically weighted degree.

### Adding dependent terms to improve the model

Definition of the geometrically weighted degree (gwdegree)
Model building with gwdegree
plot network diagnostics

## Conclusion

Knowledge about how they interact can lead to better understanding of a great many diseases and it can help in the design of appropriate therapies. 
Results showed that proteins of high degree were far more likely to be lethal than those of lower degree.
Findings through the exploratory data analysis and the modeling of the network showed consistent results. We were able to extract rich insight from the network analysis of the PPI.


